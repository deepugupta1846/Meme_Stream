{% extends 'base.html' %}
{% load static %}
{% block title %}signup{% endblock title %}
{% block script %}
<script type="text/javascript">
    function validateForm()
    {
        var pwd =document.getElementById("id_Password");
        var cpwd =document.getElementById("cpwd");
        var msg =document.getElementById("errmsg");
        var re = /^(?=.*\d)(?=.*[!@#$%^&*])(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
        var pwdd = pwd.value;
        var cpwdd = cpwd.value;
        msg.style.display="block";
        if(!pwdd.match(re))
        {
                msg.innerHTML="Invalid Password";
                pwd.value="";
                cpwd.value="";
                return false;
        }
        else
        if (pwdd != cpwdd)
            {
                msg.innerHTML="Password and Confirm password must be same.";
                cpwd.value="";
                return false;
            }
        return true;
    }




function otpsend()
    {
        var email = document.getElementById("emailid").value;
        var img = document.getElementById("load");
        var emailbox = document.getElementById("emailid")
        var btn = document.getElementById("sendbtn");
        var textbox = document.getElementById("otpid");
        var verifybtn = document.getElementById("verifybtn");
        try{
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange=function(){
            if(this.readyState==4)
            {

                    if(this.status == 200)

                    {
                        img.value=="4";
                        img.style.display="None";
                        btn.style.display="block";
                        textbox.style.display="block";
                        verifybtn.style.display="block";
                        emailbox.readOnly = true;
                        btn.value="Resend";
                   }
                   else if(this.status==403)
                   {
                    alert("Forbidden");
                   }
                   else if(ihis.status==404)
                   {
                    alert("page not found");
                   }
            }
             else if(this.readyState==1)
             {
                img.style.display="block";
                btn.style.display="None";
                img.value="1";

             }
             else if(this.readyState==2)
             {
             img.value="2";
             }
             else if(this.readyState==3)
             {
             img.value="3";
             }

        };
            xhttp.open("GET", "/otpsend/"+email+"/", true);
            xhttp.send();
        }
        catch(x)
        {
        alert(x);
        }
    }

function otpverify()
    {
        var textbox = document.getElementById("otpid").value;
        var tb = document.getElementById("otpid");
        var verifybtn = document.getElementById("verifybtn")
        var sendbtn = document.getElementById("sendbtn");
        var submit = document.getElementById("submit");
        try{
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange=function(){
            if(this.readyState==4 && this.status == 200)
            {

                    var myObj = JSON.parse(this.responseText);

                    if(myObj.response==0)
                    {
                        tb.style.borderColor = "red";
                    }
                    else
                    {
                        tb.style.borderColor = "green";
                        verifybtn.innerHTML="Verify";
                        verifybtn.style.backgroundColor = "green";
                        verifybtn.disabled = true;
                        sendbtn.disabled = true;
                        submit.disabled = false;
                        tb.readOnly = true;
                    }

            }

        };
            xhttp.open("GET", "/otpverify/"+textbox+"/", true);
            xhttp.send();
        }
        catch(x)
        {
        alert(x);
        }
    }


function insert()
    {

    }
    </script>
{% endblock script %}
{% block mid %}
    <p class="alert alert-danger" id="errmsg"></p>
    <p class="alert alert-success" id="captchaerr"></p>
<p>{{m}}</p>
    <form action="" method="post" onsubmit="return validateForm();">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-3">
                User Name
            </div>
             <div class="col-md-9">
                <input type="text" placeholder="Enter User Name" class="form-control mb-2" id="user_name" name="username" required/>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
               Gender
            </div>
             <div class="col-md-4">
                <input type="radio" id="male" name="gender" value="male">
                <label for="male">Male</label>
            </div>
            <div class="col-md-4">
                <input type="radio" id="female" name="gender" value="female">
                <label for="female">Female</label>
            </div>
        </div>
       <div class="row">
            <div class="col-md-3">
                Email ID
            </div>
             <div class="col-md-6">
                <input type="email" placeholder="Enter Email ID" class="form-control mb-2" id="emailid" name="email_id"/>
            </div>
           <div class="col-md-3">
               <input type="button" class="btn btn-warning btn-sm" onclick="otpsend();" id="sendbtn" value="Send"/>
               <!--<img src="{% static 'app/images/ZZ5H.gif' %}" id="load" width="30px" >-->
               <progress value="0" max="4" id="load"></progress>
           </div>
        </div>
        <div class="row">
            <div class="col-md-3">

            </div>
             <div class="col-md-5">
                <input type="text" placeholder="Enter OTP" class="form-control mb-2" id="otpid"/>
            </div>
           <div class="col-md-4">
               <input type="submit" class="btn btn-danger btn-sm" id="verifybtn" onclick="otpverify();" value="Verify"/>
           </div>
        </div>
       <div class="row">
            <div class="col-md-3">
               Password
            </div>
             <div class="col-md-9">
                <input type="password" placeholder="Enter Password" class="form-control mb-2" id="id_Password" name="paasword"/>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                Confirm Password
            </div>
             <div class="col-md-9">
                <input type="password" placeholder="Enter Confirm Password" class="form-control mb-2" id="cpwd"/>
            </div>
        </div>

    <input type="submit" value="Submit" class="btn btn-block btn-primary" id="submit" disabled />
    </form>

{% endblock mid %}
{% block last %}
{% endblock last %}
